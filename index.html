<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library</title>
    <style>
*{
    margin: 0;
    padding: 0;
}
.container{
    width: 100%;
    height: 100vh;
    display: grid;
    grid-template-rows: 15% 1fr;
    grid-template-areas: 
        "head"
        "body"
    ;
}

.header{
    grid-area: head;
    display: flex;
    justify-content: center;
    padding-top: 1em;
}
h1{
    font-size: 5em;
}
.main{
    display: grid;
    grid-area: body;
    background-color: aqua;
    grid-template-columns: 20% 1fr 1fr 1fr 1fr 1fr 20%;
    grid-template-rows:  1fr 1fr 1fr 1fr 10%;
    grid-template-areas: 
    "..... book1 book2 clerk book3 book4 ..... "
    "..... book5 book6 dewey book7 book8 ....."
    "..... ..... footer footer footer ..... ..... "
    ;
    gap: 1em;

}
@media only screen and (max-width: 1600px){
.main{
    grid-template-columns: 10% 1fr 1fr 1fr 1fr 1fr 10%;
}
}
@media only screen and (max-width: 1500px){
.main{
    grid-template-columns: 5% 1fr 1fr 1fr 1fr 1fr 5%;
}
}
@media only screen and (max-width: 1400px){
.main{
    grid-template-columns: 1% 1fr 1fr 1fr 1fr 1fr 1%;
}
}
@media only screen and (max-width: 1250px){
.main{
    background-color: brown;
    grid-template-columns: 10% 1fr 1fr 1fr 10%;
    grid-template-rows:  1fr 1fr 1fr 1fr 10%;
    grid-template-areas: 
    "..... book1 clerk book2 ..... "
    "..... book3 book4 book5 ....."
    "..... book6 book7 book8 ....."
    " ..... ..... dewey ..... ....."
    "..... footer footer footer .....  "
    ;

}
}


@media only screen and (max-width: 600px){
.main{
    background-color:blue;
}
}





.cardTemplate{
    height: 22em;
    max-height: 22em;
    padding: .5em;
    border: .15em solid black ;
    border-radius: .5em;

}
.clerk{
    padding: 0;
    grid-area: clerk;
}
.clerkCard{
    display: flex;
    flex-direction: column;
    justify-items: center;
    min-width: 12.75em;
    background-color: bisque;
    /* height: 22em;
    max-height: 22em; */
    /* margin: 20px; */
    /* padding: .5em;
    border: .15em solid black ;
    border-radius: .5em; */
}
.callTheClerk{
display: block;
}
.addTheBook{
    display: none;
}

.inlineRadio{
    display: inline-block;
}
.form_input{
    display: block;
}
.cardCentered{
    display: flex;
    flex-direction: column;
    justify-items: center;
    align-items: center;
    padding: .5em;
    gap: .5em;
}

.form_mesg{
    display: block;
}


.verifiedInput{

    border-color: darkgreen;
}
.invalidInput{
    border-color: orangered;
}

.dewey{
    grid-area: dewey;
    background-color: gainsboro;
    color:darkslategrey;
    max-height: 22em;
    padding: 1em;
    
}
.dewey li{
    margin: 1em;
}

.bookshelf{
    grid-area: book;
}
.book{
    /* display: flex; */
    justify-items: center;
    position: relative;
    width: 12.5em;
    height: 22em;
    background-image: url("bookcover.jpg");
    background-size: cover;
    border: 1px solid rgb(136, 136, 136);
    border-radius: .5em;
    padding: 1em;
    color: rgb(153, 177, 198);
}
.book h4{
    font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
    font-size: 1.5em;
    color: white;
    text-decoration: underline;
}
.book p{
    padding-left: 1em;
    font-size: 1.25em;
}
.cardStatus{
    display: block;
    text-align: center;
    padding-top: .75em;
    padding-bottom: .75em;
}
.book button{
    display: block;
    margin-left: auto;
    margin-right: auto;
    padding: .25em;
    margin-top: .75em;
}


.buttonBox{
    width: 100%;
    position: absolute;
    bottom: 1em;
    right: 0;
    display: flex;
    flex-direction: column;
    
}
.ghost{

    pointer-events: none;
    opacity: 0%;
}
.red{
    border-color: brown;
}

.book1{
    grid-area: book1;
    content: attr(data-title); 
    /* opacity: 45%; */
}
.book2{
    grid-area: book2;
}
.book3{
    grid-area: book3;
}
.book4{
    grid-area: book4;
}
.book5{
    grid-area: book5;
}
.book6{
    grid-area: book6;
}
.book7{
    grid-area: book7;
}
.book8{
    grid-area: book8;
}

#dewTable{
    background-color: aquamarine;
    border: 1px solid black;
    width: 95%;
    margin: auto;
}
#dewTable th{
    border: 1px dotted black;
}
.dewTableKey{
    text-decoration: underline;
}
.deweyBook{
    font-size: .75em;
}



.whodis{
    grid-area: footer;
    display: flex;
    justify-content: center;
    padding: .5em;

}
.manual{
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-content: center;
    align-items: center;
    grid-area: manual;
}
.instruction{
    border: .25em solid black;
    border-radius: .25em;
    padding .5em;
    max-width: 40%;
    margin: 1em;
}

.red{
    border-color: crimson;
}


    </style>
</head>



<body>

    <div class="container">
    <div class="header">
        <h1>Library</h1>
    </div>
                                                                <!-- MAIN HTML -->



    <div class="main">
        <div  
        class="book book1 cardTemplate ghost" 
        id="book1"
        data-ddsindex = 0;
        data-bookslot=""
        data-title="s"
        data-author=""
        data-pagecount=0;
        data-status="unread"
        >
            <h4 class="cardTitle">
            </h4>
            <p class="cardAuthor"></p>
            <p class="cardPages"><span class="cardPagesCount"></span></p>
            <span class="cardStatus"></span>
                <div class="buttonBox">
                <button class="cardReadButton">read</button>
                <button class="cardRemoveButton">remove</button>
                </div>
        </div>


        <div class="book book2 cardTemplate ghost"
        id="book2"
        data-bookslot=""
        data-title=""
        data-author=""
        data-pagecount=0;
        data-status="unread">
        <h4 class="cardTitle">
        </h4>
        <p class="cardAuthor"></p>
        <p class="cardPages"><span class="cardPagesCount"></span></p>
        <span class="cardStatus"></span>
        <div class="buttonBox">
            <button class="cardReadButton">read</button>
            <button class="cardRemoveButton">remove</button>
        </div></div>



        <div class="clerk">
            <div class="callTheClerk clerkCard cardTemplate" id="callTheClerk">
                <h3>Hello</h3>
                <p>there are <span id="catalogTotalSpan">0</span> books in the system.</p>
                <button id="switchButton">Add a New Book +</button>
            </div>
            <div class="addTheBook clerkCard cardTemplate" id="addTheBook">
                <label for="titleInput" class="form_input">Title</label> 
                <input type="text" id="titleInput" class="form_input">
                <label for="authorInput" class="form_input">Author</label> 
                <input type="text" id="authorInput" class="form_input">
                <label for="pageInput" class="form_input">Page Count</label> 
                <input type="text" id="countInput" class="form_input">
                <br>
               
                <input type="radio" class="inlineRadio" id="haveRead" name="read_status" value="read">
                <label for="haveRead"  class="inlineRadio"  >Have Read</label>
                <input type="radio" class="inlineRadio" id="hnotRead" name="read_status" value="unread">
                <label for="hnotRead" class="inlineRadio" >Haven't Read</label><br>
                <div class="cardCentered">
                    <span class="form_mesg" id="formMesg">looks good</span>
                    <button id="submitButton">Submit</button>
                    <button id="switchButton2">Cancel</button>
                </div>
            </div>
        </div>

        <div class="book book3 cardTemplate ghost" 
        id="book3"
        data-bookslot=""
        data-title=""
        data-author=""
        data-pagecount=0;
        data-status="unread">
        <h4 class="cardTitle">
        </h4>
        <p class="cardAuthor"></p>
        <p class="cardPages"><span class="cardPagesCount"></span></p>
        <span class="cardStatus"></span>
        <div class="buttonBox">
            <button class="cardReadButton">read</button>
            <button class="cardRemoveButton">remove</button>
        </div></div>


        <div class="book book4 cardTemplate ghost" 
        id="book4"
        data-bookslot=""
        data-title=""
        data-author=""
        data-pagecount=0;
        data-status="unread"><h4 class="cardTitle">
        </h4>
        <p class="cardAuthor"></p>
        <p class="cardPages"><span class="cardPagesCount"></span></p>
        <span class="cardStatus"></span>
        <div class="buttonBox">
            <button class="cardReadButton">read</button>
            <button class="cardRemoveButton">remove</button>
        </div></div>
        <div class="book book5 cardTemplate ghost" id="book5"
        data-bookslot=""
        data-title=""
        data-author=""
        data-pagecount=0;
        data-status="unread"
        >
            <h4 class="cardTitle">
            </h4>
            <p class="cardAuthor"></p>
            <p class="cardPages"><span class="cardPagesCount"></span></p>
            <span class="cardStatus"></span>
            <div class="buttonBox">
                <button class="cardReadButton">read</button>
                <button class="cardRemoveButton">remove</button>
        </div>
        </div>
        <div class="book book6 cardTemplate ghost" id="book6"
        data-bookslot=""
        data-title=""
        data-author=""
        data-pagecount=0;
        data-status="unread"
        >
            <h4 class="cardTitle">
            </h4>
            <p class="cardAuthor"></p>
            <p class="cardPages"><span class="cardPagesCount"></span></p>
            <span class="cardStatus"></span>
            <div class="buttonBox">
                <button class="cardReadButton">read</button>
                <button class="cardRemoveButton">remove</button>
        </div>
        </div>
        
        <div  class="dewey cardTemplate">
            <table id="dewTable">
                <th colspan="2">Dewey Decimal System</th>
                <tr><td class="dewTableKey">Title</td><td class="dewTableKey">Author</td></tr>


            </table>
    
        </div>
        
        <div class="book book7 cardTemplate ghost" id="book7"
        data-bookslot=""
        data-title=""
        data-author=""
        data-pagecount=0;
        data-status="unread"
        >
            <h4 class="cardTitle">
            </h4>
            <p class="cardAuthor"></p>
            <p class="cardPages"><span class="cardPagesCount"></span></p>
            <span class="cardStatus"></span>
            <div class="buttonBox">
                <button class="cardReadButton">read</button>
                <button class="cardRemoveButton">remove</button>
        </div>
        </div>
        <div class="book book8 cardTemplate ghost" id="book8"
        data-bookslot=""
        data-title=""
        data-author=""
        data-pagecount=0;
        data-status="unread"
        >
            <h4 class="cardTitle">
            </h4>
            <p class="cardAuthor"></p>
            <p class="cardPages"><span class="cardPagesCount"></span></p>
            <span class="cardStatus"></span>
            <div class="buttonBox">
                <button class="cardReadButton">read</button>
                <button class="cardRemoveButton">remove</button>
        </div>
        </div>

    <div class="whodis">
        Book img: Annie Spratt @anniespratt on unsplash.com




@anniespratt
    </div>
</div>
</div>
</body>




<script>
function runTest(){
    
    library.push({title: 'qwe', author: 'qwe', pageCount: '2', status: 'read'},{title: 'qwwqde', author: 'qwe', pageCount: '2', status: 'read'},{title: 'qw23e', author: 'qwe', pageCount: '2', status: 'read'});
    updateLibrary()
}

let library = [];

let bookShelf = [];
let bookCount = 0;
let validTitle = false;
let validAuthor = false;
let validCount = false;
let validRead = false;
let validForm = false;

const callTheClerk = document.getElementById('callTheClerk');
const addTheBook = document.getElementById('addTheBook');
const switchButton = document.getElementById('switchButton');
const switchButton2 = document.getElementById('switchButton2');
const submitButton = document.getElementById('submitButton');
const titleInput = document.getElementById('titleInput');
const authorInput = document.getElementById('authorInput');
const countInput = document.getElementById('countInput');
const haveRead = document.getElementById('haveRead');
const hnotRead = document.getElementById('hnotRead');
const dewey = document.getElementById('dewey');
const read_status =  document.getElementsByName('read_status');
const formMesg = document.getElementById('formMesg');
const bookSlot = document.querySelector('#bookslot');
const book1 = document.getElementById('book1');
const book2 = document.getElementById('book2');
const book3 = document.getElementById('book3');
const book4 = document.getElementById('book4');
const book5 = document.getElementById('book5');
const book6 = document.getElementById('book6');
const book7 = document.getElementById('book7');
const book8 = document.getElementById('book8');
let editor = [book1, book2, book3, book4, book5, book6, book7, book8]
const dewTable = document.getElementById('dewTable');
const catalogTotalSpan = document.getElementById('catalogTotalSpan');



                                                                    // Card Switch
switchButton.addEventListener('click', e => {
        e.preventDefault();
       callClerk();
    });
switchButton2.addEventListener('click', e => {
        e.preventDefault();
       callClerk();
    });
submitButton.addEventListener('click', e =>{
        verifyForm();
        let submittedStatus = "";
        
        if (document.getElementById('haveRead').checked) {
            submittedStatus = document.getElementById('haveRead').value;
        }else if(document.getElementById('hnotRead').checked) {
            submittedStatus = document.getElementById('hnotRead').value;
        }else{console.log("poteniol form error with radio button");}





       addBookToLibrary(titleInput.value, authorInput.value, countInput.value, submittedStatus);
})
                                    // This updates the "read/unread" display on the card from the button click
document.querySelectorAll('.cardReadButton').forEach(item=>{
        item.addEventListener('click', event=>{ 
            let target= event.target;
            let parent = target.parentElement;
            let parentDiv = parent.parentElement;
            let childSpan = parentDiv.getElementsByClassName('cardStatus');

            console.log(childSpan[0].innerHTML);
            // childSpan.textContent ='replace';

            // console.log(childSpan.value);

            if(parentDiv.dataset.status === "read"){
                parentDiv.dataset.status = "unread";
                console.log(target);
                target.classList.add("red");   
                // console.log("at,,.,.," + parentDiv)
                childSpan[0].innerHTML="unread"
            
                
            }else if(parentDiv.dataset.status === "unread" ){
               parentDiv.dataset.status = "read";
               target.classList.remove("red"); 
               childSpan[0].innerHTML="read"
            }

        // console.log( 'grabbing title of grandparent ' + parentDiv.dataset.status)
        })})

document.querySelectorAll('.cardRemoveButton').forEach(item=>{
    item.addEventListener('click', event=>{
    let target= event.target;
            let parent = target.parentElement;
            let parentDiv = parent.parentElement;
            let childSpan = parentDiv.getElementsByClassName('cardStatus');
            deleteBookFromLibrary(parentDiv.dataset.ddsindex);

})})



function deleteBookFromLibrary(indexNumber){

let i = indexNumber;
                    editor[i].querySelector('.cardTitle').innerHTML="";
                    editor[i].querySelector('.cardAuthor').innerHTML="";
                    editor[i].querySelector('.cardPages').innerHTML="";
                    editor[i].querySelector('.cardStatus').innerHTML="";
                    editor[i].classList.add('ghost');



    library.splice(indexNumber, 1);
    updateLibrary();
    updateDewey();
    updateCatalogSummary(library.length);
}

                                                        // VERIFY INPUTS

function verifyTitle(str){
console.log("verifying title with input of: " + str)
    regexp = /([A-Z]|[a-z]|\d)+/;
   if (regexp.test(str)){
       
        titleInput.classList.add("verifiedInput");
        titleInput.classList.remove("invalidInput");
        verifyForm();
        return true;
   }else{
       console.log("fail title");
       titleInput.classList.remove("verifiedInput");
       titleInput.classList.add("invalidInput");
       verifyForm();
       return false;
   }
}
function verifyAuthor(str){
console.log("verifying author with input of: " + str)
    regexp = /([A-Z]|[a-z]|\d)+/;
   if (regexp.test(str)){
      
        authorInput.classList.add("verifiedInput");
        authorInput.classList.remove("invalidInput");
        verifyForm();
        return true;
   }else{
        authorInput.classList.remove("verifiedInput");
        authorInput.classList.add("invalidInput");
        console.log("fail author");
        verifyForm();
        return false;
   }
}
function verifyCount(num){
console.log("verifying title with input of: " + num)
    regexp = /\d/;
   if (regexp.test(num)){
    
        countInput.classList.add("verifiedInput");
        countInput.classList.remove("invalidInput");
        verifyForm();
        return true;
   }else{
        countInput.classList.remove("verifiedInput");
        countInput.classList.add("invalidInput");
        console.log("fail count");
        verifyForm();
        return false;
   }
}
function verifyRadio(){
    if(haveRead.checked){
        validRead = true;
        verifyForm();
    }else if(document.getElementById("hnotRead").checked){
        validRead = true;
        verifyForm();
    }else{
        validRead = false;
    }
}
haveRead.addEventListener('click', e =>{
    console.log("click");   
    verifyRadio();
})
hnotRead.addEventListener('click', e =>{
        verifyRadio();
})
                                                        // Verify Form
function verifyForm(){
    let bookIndex = bookCount + 1;
   
    if(validTitle === true && validAuthor === true && validCount === true & validRead === true){
        validForm = true;
    }else{ 
        console.log("invalid form")
        validForm = false;
    }
}

titleInput.addEventListener('focus', e =>{
    formMesg.innerHTML="Fill out all fields";
})
// BLUR check
document.querySelectorAll(".form_input").forEach(inputElement => { 
        inputElement.addEventListener("blur", e =>{    
            if(e.target.id === "titleInput"){
                if(verifyTitle(e.target.value)===true){
                
                    validTitle = true;
                    verifyForm();
                }else{
                    validTitle = false;
                    
                }
            }else if(e.target.id === "authorInput"){
                if(verifyAuthor(e.target.value)===true){
                 
                    validAuthor = true;
                    verifyForm();
                }else{
                    validAuthor = false;
                    console.log("author failed blur check")
                }
            }else if(e.target.id === "countInput"){
                if(verifyCount(e.target.value)===true){
                 
                    validCount = true;
                    verifyForm();
                }else{
                    validCount = false;
                    console.log("count failed blur check")
                }
            }else if(e.target.id === "haveRead"){
                if(verifyCount(e.target.value)===true){
                 
                    validCount = true;
                    verifyForm();
                }else{
                    validCount = false;
                    console.log("count failed blur check")
                }
            }
        })
                })




                // TO BE DONE REWORK FUNCTION INTO CLASS





                function constructBook(title, author, pageCount, status){
              
                this.title = title;
                this.author = author;
                this.pageCount= pageCount;
                this.status = status;
                this.getInfo = function(){
                    console.log("Book registered " + title);
                }

}
function errorMessage(mesg){

console.log(mesg);  
formMesg.innerHTML=mesg;

}
function addBookToLibrary(title, author, pageCount, status) {
    if(validForm === true){   
                                                            // SCAN FOR DUPLICATES FIRST!
            let alreadyHave = false;
            console.log(title);
            for(i=0; i<8; i++){
                                
                                if(library[i]!== undefined){
                                    if (title === library[i]["title"]){
                                    console.log("duplicate located at index: " + i); 
                                        errorMessage("Book Already In System");
                                        return;
                                    }
                                }
            }
                


                let newBook = new constructBook(title, author, pageCount, status)
                library.push(newBook);
                bookCount ++;
                updateLibrary();
                updateDewey();
                }                }                                 


function updateCatalogSummary(total){
            catalogTotalSpan.textContent=total;
}
                //change dewey to bounce from library
function updateDewey(){
    let l=library.length-1;
    // let incoming = `${titleInput.value} by ${authorInput.value}. ${countInput.value} pages.`;
    // dewey.append(incoming);
    let catalogTotal = library.length;
    let tl = dewTable.rows.length;

    if(tl >2 ){
        console.log("activing tl is greater than 2")
    for(d=0; d < tl-2; d++){
        console.log("d: " + d);
        console.log("tl is " + tl);
        console.log("moving to delete index: " + (d+2));
         dewTable.deleteRow(2);
        };
    }


    for(i=0; i<catalogTotal;i++){

        if(library.length === 0){
            console.log("empty");
            return};


        var row = dewTable.insertRow(i+2);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);


        cell1.innerHTML = library[i]["title"];
        cell1.classList.add("deweyBook");
        cell2.innerHTML = library[i]["author"];
        cell2.classList.add("deweyBook");

            // dewTable
    }









}

function updateLibrary(){    
        if(library.length > 0){console.log("updating library");
        }else{return;}
        updateCatalogSummary(library.length);

        let shelfCap = 8;
                for(i=0; i<shelfCap; i++){
                if(library[i]=== undefined){
                 
                    editor[i].querySelector('.cardTitle').innerHTML="";
                    editor[i].querySelector('.cardAuthor').innerHTML="";
                    editor[i].querySelector('.cardPages').innerHTML="";
                    editor[i].querySelector('.cardStatus').innerHTML="";

                    editor[i].classList.add('ghost');
             



                }else if(library[i]["title"].length>0){

            
                    editor[i].dataset.ddsindex=[i];
                    
                    editor[i].querySelector('.cardTitle').innerHTML=library[i]["title"];
                    editor[i].dataset.title=library[i]["title"];

                    editor[i].querySelector('.cardAuthor').innerHTML=library[i]["author"];
                    editor[i].dataset.author=library[i]["author"];

                    editor[i].querySelector('.cardPages').innerHTML=library[i]["pageCount"];
                    editor[i].dataset.pagecount=library[i]["pageCount"];

                    editor[i].querySelector('.cardStatus').innerHTML=library[i]["status"];
                    editor[i].dataset.status=library[i]["status"];


                    editor[i].classList.remove('ghost');
                }
            }
            updateDewey();
        }




function callClerk(){
    // grabs cards and changes status

    if(callTheClerk.style.display !== "none"){
        callTheClerk.style.display = "none";
    }else if(callTheClerk.style.display === "none"){
        callTheClerk.style.display = "block";
    }
   
    console.log(addTheBook.style.display);
    if(addTheBook.style.display === "block"){
        addTheBook.style.display = "none";
    }else if(addTheBook.style.display === "none" || addTheBook.style.display === ''){
        addTheBook.style.display = "block";

    }
  

}




updateLibrary();





</script>
</html>